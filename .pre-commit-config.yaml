# See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks
repos:
  # Python.
  - repo: https://github.com/psf/black-pre-commit-mirror
    rev: 24.2.0
    hooks:
      - id: black
  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        name: isort (python)

  # Markdown.
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.40.0
    hooks:
      - id: markdownlint-fix
        args: [--disable, MD033, MD036]

  # Local scripts.
  - repo: local
    hooks:
      - id: marcion-validate
        name: marcion-validate
        entry: dictionary/marcion.sourceforge.net/img_validate.sh
        language: script
        # N.B. It's not currently possible to limit this pre-commit to a
        # specific directory or set of files because it needs to be run on
        # deletions as well, which is not straightforward to support in
        # pre-commit.
        pass_filenames: false

      - id: doctoc
        name: doctoc
        entry: doctoc
        language: system
        types: [markdown]

      - id: tidy-html
        name: tidy-html
        entry: tidy -indent -modify -quiet
        language: system
        files: '.*\.html'

      - id: tidy-xml
        name: tidy-xml
        entry: tidy -indent -modify -xml -quiet
        language: system
        files: '.*\.(xml|xhtml)'

      # N.B. This pre-commit rule forces us to host at least placeholder unit
      # tests in each Python directory, otherwise test discovery will fail and
      # the pre-commit will fail.
      # This is OK. Placeholder tests are also a reminder for us to write them.
      - id: python-unittest
        name: python-unittest
        entry: bash -c 'for x in $(dirname "$@" | uniq); do python -m unittest discover "$x"; done' --
        language: system
        types: [python]
        verbose: true
